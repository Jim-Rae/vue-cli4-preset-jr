<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目框架解读 | 基于vue-cli4的前端项目框架</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/vue-cli4-preset-jr/assets/css/0.styles.1424c3e1.css" as="style"><link rel="preload" href="/vue-cli4-preset-jr/assets/js/app.60b5ef5d.js" as="script"><link rel="preload" href="/vue-cli4-preset-jr/assets/js/2.1185113e.js" as="script"><link rel="preload" href="/vue-cli4-preset-jr/assets/js/7.57d33906.js" as="script"><link rel="prefetch" href="/vue-cli4-preset-jr/assets/js/3.80eba41b.js"><link rel="prefetch" href="/vue-cli4-preset-jr/assets/js/4.fca74266.js"><link rel="prefetch" href="/vue-cli4-preset-jr/assets/js/5.3be5c6bb.js"><link rel="prefetch" href="/vue-cli4-preset-jr/assets/js/6.e92fbccf.js"><link rel="prefetch" href="/vue-cli4-preset-jr/assets/js/8.6e06c87b.js"><link rel="prefetch" href="/vue-cli4-preset-jr/assets/js/9.7d6ac55b.js">
    <link rel="stylesheet" href="/vue-cli4-preset-jr/assets/css/0.styles.1424c3e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-cli4-preset-jr/" class="home-link router-link-active"><!----> <span class="site-name">基于vue-cli4的前端项目框架</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-cli4-preset-jr/" class="sidebar-link">介绍</a></li><li><a href="/vue-cli4-preset-jr/start.html" class="sidebar-link">快速使用</a></li><li><a href="/vue-cli4-preset-jr/client.html" class="sidebar-link">PC端与移动端</a></li><li><a href="/vue-cli4-preset-jr/frame.html" class="active sidebar-link">项目框架解读</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#src-api" class="sidebar-link">src/api</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#src-assets" class="sidebar-link">src/assets</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#src-components" class="sidebar-link">src/components</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#src-filter" class="sidebar-link">src/filter</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#src-store" class="sidebar-link">src/store</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#src-utils" class="sidebar-link">src/utils</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#src-view" class="sidebar-link">src/view</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#src-router-js" class="sidebar-link">src/router.js</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#babel" class="sidebar-link">babel</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#public" class="sidebar-link">public</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#vue-config-js" class="sidebar-link">vue.config.js</a></li><li class="sidebar-sub-header"><a href="/vue-cli4-preset-jr/frame.html#各种配置文件" class="sidebar-link">各种配置文件</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="项目框架解读"><a href="#项目框架解读" class="header-anchor">#</a> 项目框架解读</h1> <p>在这里我将使用本脚手架预设的PC端模板 <code>generator/template</code> 来进行项目框架的解读，移动端模板 <code>generator/template-m</code> 大同小异。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>本文档框架解读无法兼顾部分细节内容，开发者可以参照源码进行理解</p></div> <h2 id="src-api"><a href="#src-api" class="header-anchor">#</a> src/api</h2> <p>该文件夹用于放置 http 请求逻辑。</p> <p>其目录结构为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>api
├── axios-config.json  <span class="token comment"># axios配置</span>
├── index.js  <span class="token comment"># 请求逻辑</span>
└── mock.js  <span class="token comment"># 模拟数据</span>
</code></pre></div><p>本框架使用了http请求库 <a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">axios<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，所以在该文件夹会有一个 <code>axios-config.js</code> 的 js 文件对其进行全局配置。主要包括 axios 基本属性的配置以及请求拦截器与响应拦截器的配置。</p> <p>在请求拦截器中对 http 请求加入时间戳，避免从缓存中拿数据。在响应拦截器中对 http 响应作出响应码处理，实现响应码的统一处理。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'@/router'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> http <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseURL<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'http://jimrae.top'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  timeout<span class="token operator">:</span> <span class="token number">10000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 请求拦截</span>
http<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> method <span class="token operator">=</span> config<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 加入请求时间戳，避免从缓存中拿数据</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'get'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>params <span class="token operator">||</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>params<span class="token punctuation">.</span>_t <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 返回拦截</span>
http<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 对接口返回做统一处理, 这里要跟后台约定好接口异常返回的数据格式</span>
  <span class="token comment">/* 下面处理仅针对返回格式如下的后台接口
   * {
   *    code: 200 | 400 | 401 | ...,
   *    data: {},
   *    message: &quot;信息说明
   * }
  */</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* eslint-disable */</span>
    <span class="token keyword">case</span> <span class="token number">200</span><span class="token operator">:</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">400</span><span class="token operator">:</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">401</span><span class="token operator">:</span> router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'login'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'服务器失联了，请稍候再试'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* eslint-enable */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> http<span class="token punctuation">;</span>
</code></pre></div><p>与业务相关的请求逻辑放在该文件夹中的 <code>index.js</code> 文件，以一个 function 对应一个 url 请求的形式，将所有的 function 放在一个 <code>api</code> 对象中，通过 <code>Vue.mixin</code> 混入 vue 实例当中，即可通过 <code>this.$_api.getList(params)</code> 的方式进行请求。</p> <p>其中定义请求 function 的格式预设了两种，分别为<strong>简洁式</strong>与<strong>细颗粒式</strong>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// GET方法示例（简洁配置）</span>
  <span class="token function-variable function">getList</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/getList'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">// GET方法示例（细粒度配置）</span>
  <span class="token function">getList2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 是否使用模拟数据</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mockSwitch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>mockData<span class="token punctuation">.</span>news<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 对返回数据进行过滤或操作</span>
      <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/getList'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 根据实际情况处理成功返回的数据</span>
          <span class="token comment">// 如：</span>
          <span class="token comment">// if (res.status) {</span>
          <span class="token comment">//   return Promise.resolve(res.list)</span>
          <span class="token comment">// } else {</span>
          <span class="token comment">//   return Promise.resolve(res.list2)</span>
          <span class="token comment">// }</span>
          <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>同时在该文件夹中预留了一个 <code>mock.js</code> 文件存放模拟数据。</p> <h2 id="src-assets"><a href="#src-assets" class="header-anchor">#</a> src/assets</h2> <p>该文件夹用于放置<strong>静态资源</strong>、<strong>静态样式</strong>以及<strong>静态代码</strong>。</p> <p>其目录结构为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>assets
├── img  <span class="token comment"># 静态图片资源</span>
├── js
│   └── element.js  <span class="token comment"># element 分组件导入</span>
└── scss
    ├── adaptive  <span class="token comment"># 自适应相关</span>
    ├── global  <span class="token comment"># 全局样式</span>
    ├── mixin  <span class="token comment"># mixin 样式</span>
    ├── theme  <span class="token comment"># element 主题样式</span>
    ├── index.scss
    └── var.scss  <span class="token comment"># 样式变量</span>
</code></pre></div><p>本框架预设了 <code>assets/img</code> 文件夹用于存放图片资源，<code>assets/js</code> 文件夹用于存放静态代码，如 <a href="https://github.com/ElemeFE/element" target="_blank" rel="noopener noreferrer">element<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的 分组件导入的 js 代码。本框架使用的 css 预处理是 <code>scss</code> ，所以还预设了 <code>assets/scss</code> 文件夹用于放置 scss 样式文件。</p> <ul><li><code>scss/global</code> 下的样式会被 <code>main.js</code> 导入到全局，作用到整个项目；</li> <li><code>scss/adaptive</code>、<code>scss/mixin</code>、<code>scss/var.scss</code> 则需要通过在业务组件的样式代码里引入 <code>scss/index.scss</code> 后才能使用，如 <code>@import '@/assets/scss';</code></li> <li><code>scss/theme</code> 会自动作用于 <code>element</code> 组件样式。</li></ul> <h2 id="src-components"><a href="#src-components" class="header-anchor">#</a> src/components</h2> <p>该文件夹用于放置<strong>全局组件</strong>。</p> <p>其目录结构为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>components
├── Breadcrumb.vue  <span class="token comment"># 面包屑组件</span>
├── <span class="token punctuation">..</span>.  <span class="token comment"># 更多自定义组件</span>
└── index.js  <span class="token comment"># 组件注册器</span>
</code></pre></div><p>该文件夹下的组件将会全局注册到 vue 实例中，注册组件名称按优先级获取 vue 组件里的 <strong>name 属性</strong>或<strong>组件文件名</strong>。</p> <p>注册器代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> components <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">)</span>

components<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> component <span class="token operator">=</span> <span class="token function">components</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>default
  <span class="token comment">// 获取vue组件的name值或vue文件名作为注册组件名</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> component<span class="token punctuation">.</span>name <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/.*\//g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\.vue/</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> component<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="src-filter"><a href="#src-filter" class="header-anchor">#</a> src/filter</h2> <p>该文件夹用于放置 vue 的<strong>过滤器</strong>。</p> <p>其目录结构为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>filter
├── filters.js  <span class="token comment"># 各种过滤器</span>
└── index.js  <span class="token comment"># 注册器</span>
</code></pre></div><p>在 <code>filters.js</code> 逐个定义并导出过滤器函数，即可通过 vue 的过滤器用法，如 <code>{{ updateTime | timeFormat } }</code>，当然也可以通过单独导入使用，如 <code>import { timeFormat } from '@/filter/filters.js'</code>。</p> <p>下面展示其中的一个过滤器代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 时间格式化
 * @method timeFormat
 * @param {String | Number} val 时间数值
 * @param {String} replaceStr 如果val值为空，要显示的字符
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">timeFormat</span> <span class="token punctuation">(</span>val<span class="token punctuation">,</span> replaceStr <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> <span class="token operator">+</span>val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex">/^\d+$/g</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> replaceStr<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 补零操作</span>
  <span class="token keyword">const</span> <span class="token function-variable function">pad</span> <span class="token operator">=</span> <span class="token parameter">num</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> yearMonthDate <span class="token operator">=</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> hourMinSec <span class="token operator">=</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>yearMonthDate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hourMinSec<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="src-store"><a href="#src-store" class="header-anchor">#</a> src/store</h2> <p>该文件夹用于放置 vuex 全局<strong>状态管理</strong>代码。</p> <p>其目录结构为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>store
├── modules  <span class="token comment"># 分模块使用</span>
<span class="token operator">|</span>   ├── user.js
<span class="token operator">|</span>   └── <span class="token punctuation">..</span>.
└── index.js  <span class="token comment"># 注册器</span>
</code></pre></div><p>本框架对 vuex 进行分模块使用，放在 <code>store/modules</code> 文件夹里，如 <code>store/modules/user.js</code>。同样的，<code>src/store</code> 文件有一个注册器，用于加载 <code>store/modules</code> 文件夹里的所有模块。</p> <p>注册器代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createLogger <span class="token keyword">from</span> <span class="token string">'vuex/dist/logger'</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> debug <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">;</span>

<span class="token comment">// 加载modules文件夹里的vuex模块</span>
<span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./modules'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/\.js$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token function">ctx</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
  modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> module<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  modules<span class="token punctuation">,</span>

  <span class="token comment">// 在非production模式中开启strict模式</span>
  strict<span class="token operator">:</span> debug<span class="token punctuation">,</span>
  <span class="token comment">// 在非production模式中使用日志插件</span>
  plugins<span class="token operator">:</span> debug <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在注册器里除了有加载模块的逻辑外，也在开发环境中加入了 <code>vuex/dist/logger</code> 模块的使用。</p> <h2 id="src-utils"><a href="#src-utils" class="header-anchor">#</a> src/utils</h2> <p>该文件夹用于放置工具类函数。</p> <p>其目录结构为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>store
├── common.js  <span class="token comment"># 常用工具库</span>
├── dom.js  <span class="token comment"># dom 操作</span>
├── routerHelper.js  <span class="token comment"># router 工具</span>
└── validator.js  <span class="token comment"># 校验器</span>
</code></pre></div><p>本框架在该文件夹预设了四种工具类函数，分别为<strong>常用工具函数</strong>、<strong>DOM操作函数</strong>、<strong>router工具函数</strong>和<strong>校验器函数</strong>。</p> <p><code>common.js</code> 用于放置常用工具函数，如深拷贝、函数去抖、函数节流等工具函数。以独立的函数为单位分别导出各个功能函数。具体例子如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 函数去抖
 *
 * @method debounce
 * @param {(...args: any) =&gt; void} fn 要去抖的函数
 * @param {number} delay 去抖时间
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">debounce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">100</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    timer <span class="token operator">&amp;&amp;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>dom.js</code> 用于放置 <code>DOM API</code> 相关的操作函数，如事件绑定解绑操作（<code>on</code>、<code>off</code>、<code>once</code>）、类操作（<code>hasClass</code>、<code>addClass</code>、<code>removeClass</code>）等。导出方式同<code>common.js</code>。</p> <p><code>routerHelper.js</code> 用于放置 <code>Vue-Router</code> 的辅助工具函数。主要实现路由配置的动态导入、路由扁平化等处理。</p> <p>其中动态导入路由函数如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * 动态导入路由配置
 * @param {*} ctx require.context 生成的上下文对象，用于自动导入
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">importAll</span> <span class="token operator">=</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取到配置</span>
    <span class="token keyword">let</span> route <span class="token operator">=</span> <span class="token function">ctx</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
    <span class="token comment">// 可能是数组或者对象</span>
    route <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span> <span class="token operator">?</span> route <span class="token operator">:</span> <span class="token punctuation">[</span>route<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加进路由缓存</span>
    routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> routes<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="src-view"><a href="#src-view" class="header-anchor">#</a> src/view</h2> <p>该文件夹用于放置页面组件。</p> <p>该文件夹结构可按照实际情况进行调整，预设的目录结构为：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>view
├── index  <span class="token comment"># 首页</span>
<span class="token operator">|</span>   ├── components  <span class="token comment"># 页面通用组件</span>
<span class="token operator">|</span>   ├── children  <span class="token comment"># 子路由页面</span>
<span class="token operator">|</span>   ├── index.vue  <span class="token comment"># 当前页面</span>
<span class="token operator">|</span>   └── router.js  <span class="token comment"># 路由配置</span>
<span class="token operator">|</span>
└── login  <span class="token comment"># 登录页</span>
    └── <span class="token punctuation">..</span>.
</code></pre></div><p>该文件夹是主要的开发目标，所有的页面都放置在该文件夹内，其中的文件结构可以根据实际需求灵活应变。其中 <code>components</code> 文件夹代表当前页面下通用组件，<code>children</code> 文件夹用于放置子路由页面，其结构可以与 <code>view</code> 文件夹一致，<code>index.vue</code> 为当前页面组件，也称当前页面入口，该入口会被 <code>router.js</code> 导入到 <code>Vue-Router</code>。</p> <h2 id="src-router-js"><a href="#src-router-js" class="header-anchor">#</a> src/router.js</h2> <p>该文件是路由配置的入口。</p> <p>主要通过 Webpack 函数 <code>require.context</code> 来导入所有页面路由的配置，同时也预设了默认路由。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> importAll <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/routerHelper.js'</span><span class="token punctuation">;</span>

<span class="token comment">// 全局路由</span>
<span class="token keyword">class</span> <span class="token class-name">GlobalRouter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 路由表</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 初始化</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_routes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">init</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置默认路由</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setDefaultRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置导入的路由</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setImportRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 设置默认路由</span>
  <span class="token function">setDefaultRoute</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 默认路由</span>
    <span class="token keyword">const</span> defaultPath <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token comment">// 任意路由</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
        redirect<span class="token operator">:</span> <span class="token string">'/'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 默认路由</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
        redirect<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'breadcrumbDemo.index'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>defaultPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 设置导入的路由</span>
  <span class="token function">setImportRoute</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// webpack文档规定： require.context参数只接收字面量，不要用变量去控制</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./views'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/router.js$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">importAll</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GlobalRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

instance<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> instance<span class="token punctuation">;</span>

<span class="token comment">// 解决路由到重复地址时抛出NavigationDuplicated错误</span>
<span class="token keyword">const</span> originalPush <span class="token operator">=</span> <span class="token class-name">Router</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>push<span class="token punctuation">;</span>
<span class="token class-name">Router</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">push</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">push</span> <span class="token punctuation">(</span><span class="token parameter">location</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">originalPush</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="babel"><a href="#babel" class="header-anchor">#</a> babel</h2> <h2 id="public"><a href="#public" class="header-anchor">#</a> public</h2> <h2 id="vue-config-js"><a href="#vue-config-js" class="header-anchor">#</a> vue.config.js</h2> <h2 id="各种配置文件"><a href="#各种配置文件" class="header-anchor">#</a> 各种配置文件</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue-cli4-preset-jr/client.html" class="prev">
        PC端与移动端
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vue-cli4-preset-jr/assets/js/app.60b5ef5d.js" defer></script><script src="/vue-cli4-preset-jr/assets/js/2.1185113e.js" defer></script><script src="/vue-cli4-preset-jr/assets/js/7.57d33906.js" defer></script>
  </body>
</html>
